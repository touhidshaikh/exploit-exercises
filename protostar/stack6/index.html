<html>
<head>
<title>
Exploit Exercises
</title>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<link href="/assets/application-623947d16d4882a61a6f2b4989f100c2.css" media="all" rel="stylesheet" type="text/css"/>
<script src="/assets/application-5a3ba6b1be2bd14e7cd5f9ea081b673a.js" type="text/javascript"></script>
 
 
 
 
<meta content="authenticity_token" name="csrf-param"/>
<meta content="4h8Y2VcF9eN4oxgXAeffLRS+Sum8dQ+iIuDRuyNNc8E=" name="csrf-token"/>
</head>
<body>
<div class='navbar navbar-inverse navbar-fixed-top' role='navigation'>
<div class='container'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-collapse' data-toggle='collapse' type='button'>
<span class='sr-only'>Toggle navigation</span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
<a class='navbar-brand' href='/'>exploit-exercises.com</a>
</div>
<div class='navbar-collapse collapse' id='navbar-main'>
<ul class='nav navbar-nav' id='main-menu-left'>
<li class=''>
<a href='/download'>Download</a>
</li>
<li class='active dropdown'>
<a class='dropdown-toggle' data-toggle='dropdown' href='#'>
Exercises
<b class='caret'></b>
</a>
<ul class='dropdown-menu'>
<li class=''>
<a href='/nebula'>Nebula</a>
</li>
<li class='active'>
<a href='/protostar'>Protostar</a>
</li>
<li class=''>
<a href='/fusion'>Fusion</a>
</li>
<li class=''>
<a href='/mainsequence'>Main Sequence</a>
</li>
</ul>
 
</li>
<li class=''>
<a href='/news'>News</a>
</li>
<li>
<a href='http://blog.exploit-exercises.com'>Blog</a>
</li>
<li class=''>
<a href='/commercialuse'>Commercial Use</a>
</li>
</ul>
</div>
</div>
</div>
<div class='container'>
<div class='row-fluid'>
<div class='col-md-3'>
<div class='well'>
<h5>Follow us on twitter</h5>
<p>
<a class='twitter-follow-button' data-show-count='false' href='https://twitter.com/exploitexercise'>
Follow @exploitexercise
</a>
<script>
$(document).ready(function(){
  $.getScript('//platform.twitter.com/widgets.js');
});
</script>
</p>
</div>
<a class='coinbase-button' data-button-style='donation_small' data-code='c9ee595e7bd3a2f0eb24f36065ad193a' href='https://coinbase.com/checkouts/c9ee595e7bd3a2f0eb24f36065ad193a'>Donate Bitcoins</a>
<div class='list-group'>
<div class='list-group-item'>
<h4 class='list-group-heading'>Stack levels</h4>
</div>
<a class='list-group-item ' href='/protostar/stack0'>Stack 0</a>
<a class='list-group-item ' href='/protostar/stack1'>Stack 1</a>
<a class='list-group-item ' href='/protostar/stack2'>Stack 2</a>
<a class='list-group-item ' href='/protostar/stack3'>Stack 3</a>
<a class='list-group-item ' href='/protostar/stack4'>Stack 4</a>
<a class='list-group-item ' href='/protostar/stack5'>Stack 5</a>
<a class='list-group-item active' href='/protostar/stack6'>Stack 6</a>
<a class='list-group-item ' href='/protostar/stack7'>Stack 7</a>
<div class='list-group-item'>
<h4 class='list-group-heading'>Format string levels</h4>
</div>
<a class='list-group-item ' href='/protostar/format0'>Format 0</a>
<a class='list-group-item ' href='/protostar/format1'>Format 1</a>
<a class='list-group-item ' href='/protostar/format2'>Format 2</a>
<a class='list-group-item ' href='/protostar/format3'>Format 3</a>
<a class='list-group-item ' href='/protostar/format4'>Format 4</a>
<div class='list-group-item'>
<h4 class='list-group-heading'>Heap levels</h4>
</div>
<a class='list-group-item ' href='/protostar/heap0'>Heap 0</a>
<a class='list-group-item ' href='/protostar/heap1'>Heap 1</a>
<a class='list-group-item ' href='/protostar/heap2'>Heap 2</a>
<a class='list-group-item ' href='/protostar/heap3'>Heap 3</a>
<div class='list-group-item'>
<h4 class='list-group-heading'>Network programming</h4>
</div>
<a class='list-group-item ' href='/protostar/net0'>Net 0</a>
<a class='list-group-item ' href='/protostar/net1'>Net 1</a>
<a class='list-group-item ' href='/protostar/net2'>Net 2</a>
<a class='list-group-item ' href='/protostar/net3'>Net 3</a>
<div class='list-group-item'>
<h4 class='list-group-heading'>Final levels</h4>
</div>
<a class='list-group-item ' href='/protostar/final0'>Final 0</a>
<a class='list-group-item ' href='/protostar/final1'>Final 1</a>
<a class='list-group-item ' href='/protostar/final2'>Final 2</a>
</div>
</div>
<div class='col-md-9'>
<div id='flash_messages'></div>
<div id='content'>
<div class='alert alert-error hide' id='error_notice_div'>
 
</div>
<div class='alert alert-warning hide' id='warning_notice_div'>
 
</div>
<div class='alert alert-info hide' id='notice_notice_div'>
 
</div>
<div class='alert alert-success hide' id='success_notice_div'>
 
</div>
<div class='page-header'>
<h1>Protostar stack6</h1>
</div>
<h2>About</h2>
<p>
Stack6 looks at what happens when you have restrictions on the return address.
</p>
<p>
This level can be done in a couple of ways, such as finding the duplicate of the payload (
<em>objdump -s</em>
will help with this), or
<em>ret2libc</em>
, or even return orientated programming.
</p>
<p>It is strongly suggested you experiment with multiple ways of getting your code to execute here.</p>
<p>
This level is at /opt/protostar/bin/stack6
</p>
<h2>Source code</h2>
<div class="CodeRay">
<div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#579">#include</span> <span style="color:#B44;font-weight:bold">&lt;stdlib.h&gt;</span>&#x000A;<span class="line-numbers"> <a href="#n2" name="n2">2</a></span><span style="color:#579">#include</span> <span style="color:#B44;font-weight:bold">&lt;unistd.h&gt;</span>&#x000A;<span class="line-numbers"> <a href="#n3" name="n3">3</a></span><span style="color:#579">#include</span> <span style="color:#B44;font-weight:bold">&lt;stdio.h&gt;</span>&#x000A;<span class="line-numbers"> <a href="#n4" name="n4">4</a></span><span style="color:#579">#include</span> <span style="color:#B44;font-weight:bold">&lt;string.h&gt;</span>&#x000A;<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>&#x000A;<span class="line-numbers"> <a href="#n6" name="n6">6</a></span><span style="color:#088;font-weight:bold">void</span> getpath()&#x000A;<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>{&#x000A;<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>  <span style="color:#0a8;font-weight:bold">char</span> buffer[<span style="color:#00D">64</span>];&#x000A;<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>  <span style="color:#0a8;font-weight:bold">unsigned</span> <span style="color:#0a8;font-weight:bold">int</span> ret;&#x000A;<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>&#x000A;<span class="line-numbers"><a href="#n11" name="n11">11</a></span>  printf(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">input path please: </span><span style="color:#710">&quot;</span></span>); fflush(stdout);&#x000A;<span class="line-numbers"><a href="#n12" name="n12">12</a></span>&#x000A;<span class="line-numbers"><a href="#n13" name="n13">13</a></span>  gets(buffer);&#x000A;<span class="line-numbers"><a href="#n14" name="n14">14</a></span>&#x000A;<span class="line-numbers"><a href="#n15" name="n15">15</a></span>  ret = __builtin_return_address(<span style="color:#00D">0</span>);&#x000A;<span class="line-numbers"><a href="#n16" name="n16">16</a></span>&#x000A;<span class="line-numbers"><a href="#n17" name="n17">17</a></span>  <span style="color:#080;font-weight:bold">if</span>((ret &amp; <span style="color:#02b">0xbf000000</span>) == <span style="color:#02b">0xbf000000</span>) {&#x000A;<span class="line-numbers"><a href="#n18" name="n18">18</a></span>    printf(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bzzzt (%p)</span><span style="color:#b0b">\n</span><span style="color:#710">&quot;</span></span>, ret);&#x000A;<span class="line-numbers"><a href="#n19" name="n19">19</a></span>    _exit(<span style="color:#00D">1</span>);&#x000A;<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>  }&#x000A;<span class="line-numbers"><a href="#n21" name="n21">21</a></span>&#x000A;<span class="line-numbers"><a href="#n22" name="n22">22</a></span>  printf(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">got path %s</span><span style="color:#b0b">\n</span><span style="color:#710">&quot;</span></span>, buffer);&#x000A;<span class="line-numbers"><a href="#n23" name="n23">23</a></span>}&#x000A;<span class="line-numbers"><a href="#n24" name="n24">24</a></span>&#x000A;<span class="line-numbers"><a href="#n25" name="n25">25</a></span><span style="color:#0a8;font-weight:bold">int</span> main(<span style="color:#0a8;font-weight:bold">int</span> argc, <span style="color:#0a8;font-weight:bold">char</span> **argv)&#x000A;<span class="line-numbers"><a href="#n26" name="n26">26</a></span>{&#x000A;<span class="line-numbers"><a href="#n27" name="n27">27</a></span>  getpath();&#x000A;<span class="line-numbers"><a href="#n28" name="n28">28</a></span>&#x000A;<span class="line-numbers"><a href="#n29" name="n29">29</a></span>&#x000A;<span class="line-numbers"><strong><a href="#n30" name="n30">30</a></strong></span>&#x000A;<span class="line-numbers"><a href="#n31" name="n31">31</a></span>}</pre></div>
</div>
<h2>Discussion</h2>
<div id='disqus_thread'></div>
<script>
$(document).ready(function() {
  <!-- * * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */ -->
  var disqus_shortname = 'exploitexercises'; // required: replace example with your forum shortname
  // var disqus_identifer = 'test';
  var disqus_developer = 1;
  var disqus_url = "https://exploit-exercises.com/protostar/stack6";
  // var disqus_identifier = "/protostar/stack6";
  <!-- * * * DON'T EDIT BELOW THIS LINE * * */ -->
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
});


</script>
<noscript>
Please enable JavaScript to view the
<a href='https://disqus.com/?ref_noscript'>comments powered by Disqus.</a>
</noscript>
</div>
</div>
</div>
</div>
<script>
$(document).ready(function() {
  // Set up Cookies
  Flash.transferFromCookies();
  Flash.writeDataTo('error', $('#error_notice_div'));
  Flash.writeDataTo('notice', $('#notice_notice_div'));
  Flash.writeDataTo('warning', $('#warning_notice_div'));
  Flash.writeDataTo('success', $('#success_notice_div'));
});  

$(document).ready(function() {
  var data = JSON.parse(unescape($.cookie("username")));
  $.cookie('username',null, {path: '/'});

  if(!data) {
    $('.loggedin').hide();
    return;
  }
  $('.loggedoff').hide();
  $('#account_name').empty().append(data);
  
});
</script>
 
<script type='text/javascript'>
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-25780546-1']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
<script>
$(document).ready(function(){
  $.getScript("https://coinbase.com/assets/button.js");
});
</script>
</body>
</html>
